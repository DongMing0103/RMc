<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>新增食堂</title>
    <link rel="stylesheet" href="../../css/bootstrap/bootstrap.css">
    <link rel="stylesheet" href="../../css/font-awesome/font-awesome.min.css">
    <link rel="stylesheet" href="../../css/fileinput.css">
    <link rel="stylesheet" href="../../css/jquery.Jcrop.min.css">
    <link rel="stylesheet" href="../../css/scojs.css">
    <link rel="stylesheet" href="../../css/sco.message.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/style2.css">
</head>
<body>
<div class="merchants">
    <form class="form-horizontal select-merchants" id="form" name="form" enctype="multipart/form-data" action="$!rc.contextPath/canteenBaseInfoSystem/saveOrUpdate" method="post">
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="ctype">客户类别</label>
            </div>
            <div class="col-sm-5 has-feedback">
                <select class="form-control category selectarrow" name="canteenCategoryId" datatype="*" nullmsg="请选择客户类别" sucmsg=" ">
                    <option value="">请选择</option>
                    <option>厂内食堂</option>
                    <option>校内食堂</option>
                    <option>独立食堂</option>
                </select>
                <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="ctype">客户属性</label>
            </div>
            <div class="col-sm-5 has-feedback">
                <select class="form-control attribute selectarrow" name="canteenCategoryId" datatype="*" nullmsg="请选择客户属性" sucmsg=" ">
                    <option value="">请选择</option>
                    <option>代理商客户</option>
                    <option>平台客户</option>
                </select>
                <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="text-center mt30 pr">
            <a class="btn btn-warning save selectbtn" href="javascript:void(0);">下一步</a>
        </div>
    </form>
    <form class="form-horizontal add-merchants" id="form" name="form" enctype="multipart/form-data" action="" method="post" style="display: none">
        <input type="hidden" name="id" value="$!canteenId" />
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cname">名称</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" name="canteenName" placeholder="请输入食堂名称" value="" datatype="*" nullmsg="食堂名称不能为空" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cname">LOGO</label>
            </div>
            <div class="col-sm-4">
                <input type="hidden" datatype="*" nullmsg="logo不能为空" sucmsg=" " id=logo class="img" name="logo" >
                <a class="btn btn-warning btn-upload" name="upload" href="javascript:void(0);">上传图片</a>
            </div>
            <div class="col-sm-3 pt4">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-8 col-sm-offset-3">
                <div class="img-box1 imgsbox1" name="logoimg" id="logoimg"></div>
            </div>
            <div class="col-sm-9 col-sm-offset-3">
                <span class="help-block">（请上传8M以下的图片文件，支持jpg/png/gif格式，推荐200*200pix以上）</span>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cuser">负责人姓名</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" name="headRealname" placeholder="请输入姓名" value="" datatype="zh2-10" nullmsg="负责人姓名不能为空" errormsg="姓名格式不正确" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="ctel">身份证号码</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" name="headIdcard" placeholder="请输入身份证号码" value="" datatype="n15-18" nullmsg="身份证号不能为空" errormsg="身份证号格式不正确" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cname">身份证照片</label>
            </div>
            <div class="col-sm-4">
                <input type="hidden" datatype="*"  nullmsg="身份证照片不能为空" sucmsg=" " id="headIdcardPic" name="headIdcardPic" class="img headIdcardPic">
                <a class="btn btn-warning btn-upload" name="uprectangle" href="javascript:void(0);">上传图片</a>
            </div>
            <div class="col-sm-3 pt4">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-8 col-sm-offset-3">
                <div class="img-box1 imgsbox2"></div>
            </div>
            <div class="col-sm-9 col-sm-offset-3">
                <span class="help-block">（请上传8M以下的图片文件，支持jpg/png/gif格式，推荐280*210pix以上）</span>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="ctel">负责人手机号</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" name="headPhone" placeholder="请输入手机号" value="" datatype="n11" nullmsg="手机号码不能为空" errormsg="手机号码格式不正确" sucmsg=" "  #if($!baseInfoParam.status==2) readonly="readonly" #end />
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
            <div class="col-sm-8 col-sm-offset-3">
                <span class="help-block">（请填写手机号码，审核后将作为登录的账号）</span>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cname">营业执照</label>
            </div>
            <div class="col-sm-4">
                <input type="hidden" datatype="*"  nullmsg="营业执照不能为空" sucmsg=" " id="businessPic" class="img businessPic" name="businessPic">
                <a class="btn btn-warning btn-upload" name="uprectangle" href="javascript:void(0);">上传图片</a>
            </div>
            <div class="col-sm-3 pt4">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-8 col-sm-offset-3">
                <div class="img-box1 imgsbox3"></div>
            </div>
            <div class="col-sm-9 col-sm-offset-3">
                <span class="help-block">（请上传8M以下的图片文件，支持jpg/png/gif格式，推荐280*210pix以上）</span>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cpho">联系人</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" name="contactRealname" placeholder="请输入联系人姓名" value="" datatype="zh2-10" nullmsg="姓名不能为空" errormsg="姓名格式不正确" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cpho">联系电话</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" name="contactPhone" placeholder="请输入联系电话" value="" datatype="nd" nullmsg="手机号码不能为空" errormsg="手机号码格式不正确" sucmsg=" ">
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cpho">微信号</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" name="weixin" placeholder="请输入微信号" value=""/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cgeo">地理信息</label>
            </div>
            <div class="col-sm-9" id="city">
                <div class="has-feedback" style="display: inline-block;">
                    <select class="form-control prov selectarrow"></select>
                    <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
                </div>
                <div class="has-feedback" style="display: inline-block;">
                    <select class="form-control city selectarrow"></select>
                    <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
                </div>
                <div class="has-feedback" style="display: inline-block;">
                    <select name="areaCode" class="form-control dist selectarrow"></select>
                    <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
                </div>
            </div>
        </div>
        <div class="form-group geography">
            <div class="col-sm-6 col-sm-offset-3">
                <textarea name="address"  class="address" placeholder="（请输入街道门牌号）" onkeyup="myFunction()"></textarea>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-8 col-sm-offset-3">
                <div style="border: 4px solid rgb(221, 221, 221); border-image: none;">
                    <div id="allmap" style="width: 100%; height: 400px;"></div>
                    <input name="position" class="position" type="hidden" value="" >
                </div>
            </div>
            <div class="col-sm-8 col-sm-offset-3">
                <span class="help-block">（请在地图上标明地理位置）</span>
            </div>
        </div>
        <div class="form-group type1" style="display: none">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="ctype">联系业务员</label>
            </div>
            <div class="col-sm-3 has-feedback">
                <select class="form-control selectarrow" name="canteenCategoryId" datatype="*" nullmsg="请选择" sucmsg=" ">
                    <option value="">请选择</option>
                    <option>商务一部</option>
                </select>
                <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
            </div>
            <div class="col-sm-3 has-feedback">
                <select class="form-control selectarrow" name="canteenCategoryId" datatype="*" nullmsg="请选择" sucmsg=" ">
                    <option value="">请选择</option>
                    <option>奥巴马</option>
                </select>
                <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group type2" style="display: none">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="ctype">所属代理商</label>
            </div>
            <div class="col-sm-3 has-feedback">
                <select class="form-control selectarrow" name="canteenCategoryId" datatype="*" nullmsg="请选择" errormsg="请选择" sucmsg=" ">
                    <option value="">请选择</option>
                    <option>浙江杭州拱墅</option>
                </select>
                <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
            </div>
            <div class="col-sm-3 has-feedback">
                <select class="form-control selectarrow" name="canteenCategoryId" datatype="*" nullmsg="请选择" errormsg="请选择" sucmsg=" ">
                    <option value="">请选择</option>
                    <option>浙江省总代理</option>
                </select>
                <i class="fa fa-sort-down form-control-feedback triangle-fa"></i>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="text-center mt30 pr">
            <a class="btn btn-warning save role_add_save nextbtn" href="javascript:void(0);" style="display: none;">下一步</a>
            <a class="btn btn-warning save role_add_save surebtn" href="javascript:void(0);" style="display: none;">确定</a>
        </div>
    </form>
    <form class="form-horizontal add-enterprise" id="from">
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label">单位名称</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" id="eName" name="eName" placeholder="请输入单位名称" datatype="*" nullmsg="单位名称不能为空" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label">单位性质</label>
            </div>
            <div class="col-sm-5 has-feedback">
                <select class="form-control" id="eStyle" name="eStyle" datatype="*" nullmsg="单位性质不能为空" sucmsg=" ">
                    <option value="">请选择</option>
                    #foreach($!style in $!epoStyle)
                    <option value="$!style.getCode()">$!style.getName()</option>
                    #end
                </select>
                <span class="glyphicon glyphicon-triangle-bottom form-control-feedback caret-self" aria-hidden="true"></span>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cuser">联系人</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" id="contact" name="contact" placeholder="请输入联系人姓名" datatype="zh2-10" nullmsg="联系人不能为空" errormsg="联系人姓名格式不正确" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="ctel">手机号码</label>
            </div>
            <div class="col-sm-5 col-md-4 col-lg-3">
                <input class="form-control" id="mobilephone" name="mobilephone" placeholder="请输入手机号码" datatype="n11" nullmsg="手机号码不能为空" errormsg="手机号码格式不正确" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cpho">座机</label>
            </div>
            <div class="col-sm-5">
                <input class="form-control" id="telephone" name="telephone" placeholder="请输入座机号码" datatype="*" nullmsg="座机号码不能为空" sucmsg=" "/>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
            <div class="col-sm-8 col-sm-offset-3">
                <span class="help-block">（请认真填写，审核后将作为登录的账号）</span>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-3 text-right">
                <label class="control-label" for="cgeo">地理信息</label>
            </div>
            <div class="col-sm-9" id="city">
                <div class="has-feedback" style="display: inline-block;">
                    <select class="form-control prov"></select>
                    <span class="glyphicon glyphicon-triangle-bottom form-control-feedback caret-self" aria-hidden="true"></span>
                </div>
                <div class="has-feedback" style="display: inline-block;">
                    <select class="form-control city"></select>
                    <span class="glyphicon glyphicon-triangle-bottom form-control-feedback caret-self" aria-hidden="true"></span>
                </div>
                <div class="has-feedback" style="display: inline-block;">
                    <select name="areaCode" class="form-control dist"></select>
                    <span class="glyphicon glyphicon-triangle-bottom form-control-feedback caret-self" aria-hidden="true"></span>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-6 col-sm-offset-3">
                <textarea  class="address" name="address" placeholder="（请输入街道门牌号）" datatype="*" nullmsg="地理信息不能为空" errormsg="地理信息格式不正确" sucmsg=" " onkeyup="myFunction()">$!epo.address</textarea>
            </div>
            <div class="col-sm-3">
                <div class="Validform_checktip"></div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-8 col-sm-offset-3">
                <div style="border: 4px solid rgb(221, 221, 221); border-image: none;">
                    <div id="allmap" style="width: 100%; height: 400px;"></div>
                    <input name="position" class="position" type="hidden">
                </div>
            </div>
            <div class="col-sm-8 col-sm-offset-3">
                <span class="help-block">（请在地图上标明地理位置）</span>
            </div>
        </div>
        <div class="text-center mt30 pr">
            <div class="shade-save"></div>
            <a class="btn btn-warning save role_add_save" href="javascript:void(0);">确定保存</a>
        </div>
    </form>
</div>


<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=VdGhOfYto316HMEuGEiyQgjDjk8tyPF8"></script>
<script src="../../js/jQuery/jquery-1.11.1.min.js"></script>
<script src="../../js/bootstrap/bootstrap.min.js"></script>
<script src="../../js/layer/layer.js"></script>
<script src="../../js/cityselect/jquery.cityselect.js"></script>
<script src="../../js/ValidForm/Validform_v5.3.2.js"></script>
<script src="../../js/common.js"></script>
<script id="portraitUpload" type="text/html">
    <div class="modalselect">
        <form enctype="multipart/form-data" action="$!rc.contextPath/file/upload_Resize_file" method="post">
            <div class="embed-responsive embed-responsive-16by9">
                <div class="embed-responsive-item pre-scrollable selectimg">
                    <img alt="" src="../../images/showimg.jpg" id="cut-img" class="img-responsive img-thumbnail"/>
                </div>
            </div>
            <div class="white-divider-md"></div>
            <div class="uploadtips clearfix">
                <span class="tipspan"><i class="fa fa-info-circle"></i>裁剪上传图片后请记得确认保存</span>
                <input type="file" name="file" id="fileUpload" class="file" data-show-preview="false"/>
            </div>
            <div class="white-divider-md"></div>
            <div id="alert" class="alert alert-danger hidden" role="alert"></div>
            <input type="hidden" id="x" name="x"/>
            <input type="hidden" id="y" name="y"/>
            <input type="hidden" id="w" name="w"/>
            <input type="hidden" id="h" name="h"/>
        </form>
    </div>
</script>
<script id="portraitrectangle" type="text/html">
    <div class="modalselect">
        <form enctype="multipart/form-data" action="$!rc.contextPath/file/upload_Resize_file" method="post">
            <div class="embed-responsive embed-responsive-16by9">
                <div class="embed-responsive-item pre-scrollable selectimg">
                    <img alt="" src="../../images/showimg.jpg" id="cut-img" class="img-responsive img-thumbnail"/>
                </div>
            </div>
            <div class="white-divider-md"></div>
            <div class="uploadtips clearfix">
                <span class="tipspan"><i class="fa fa-info-circle"></i>裁剪上传图片后请记得确认保存</span>
                <input type="file" name="file" id="filerectangle" class="file" data-show-preview="false"/>
            </div>
            <div class="white-divider-md"></div>
            <div id="alert" class="alert alert-danger hidden" role="alert"></div>
            <input type="hidden" id="x" name="x"/>
            <input type="hidden" id="y" name="y"/>
            <input type="hidden" id="w" name="w"/>
            <input type="hidden" id="h" name="h"/>
        </form>
    </div>
</script>
<script type="text/javascript">
    /* 表单验证 */
    $('.select-merchants').Validform({
        btnSubmit : ".save",
        tiptype : 2,
        showAllError:true,
        datatype : {},
        postonce : true,
        ajaxPost : true,
        beforeCheck:function(){},
        callback : function(data) {

        }
    });
    $("body").on("click",".nextbtn",function(){
        editData('新增代理商','add_cateennext.html','768px','90%');
        parent.layer.closeAll();


    });
    $(".selectbtn").click(function(){
//        $(".add-merchants").show().siblings().hide();
//        debugger;
        var _category=$('.category option:selected').val();
        var _attribute=$('.attribute option:selected').val();
        if(_category=="厂内食堂"||_category=="校内食堂"){
           if(_attribute=="代理商客户"){
               $(".add-merchants").show().siblings().hide();
               $(".type1").show();
               $(".nextbtn").show();
           }else if(_attribute=="平台客户"){
               $(".add-merchants").show().siblings().hide();
               $(".type2").show();
               $(".nextbtn").show();
           }
        }else{

        }
    })
    $('.add-merchants').Validform({
        btnSubmit : "",
        tiptype : 2,
        showAllError:true,
        datatype : {
            "zh2-10" : /^[\u4E00-\u9FA5\uf900-\ufa2d]{2,10}$/,
            "zn" : /^[\u4E00-\u9FA50-9]+$/,
            "n11" : /^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|17[3|7]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,
            "dn11" : /^\d{3}-\d{8}|\d{4}-\d{7}$/,
            "nd":/^[0-9-]{8,}$/,
            "wn" : /^[a-zA-Z\d_]{5,}$/,
            "n15-18":/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/
        },
        postonce : true,
        ajaxPost : true,
        beforeCheck:function(){
            var prov=$('.prov').val(),
                city=$('.city').val(),
                dist=$('.dist').val(),
                textarea=$('textarea').val(),
                showInfo=$('.geography .Validform_checktip');
            if(prov != '' && city != ''  && city != null && dist != '' && dist != null && textarea != ''){
                showInfo.addClass('Validform_right');
            }else if(prov == '' && city == null && dist == null && textarea == ''){
                showInfo.addClass('Validform_wrong');
                showInfo.text('地理信息不能为空');
            }else{
                showInfo.text('地理信息不完善');
            }
        },
        callback : function(data) {
            if (data.code == 0) {
                $('.save').prev().css('display', 'none');
                parent.$("table").bootstrapTable('refresh');
                parent.layer.closeAll();
                parent.layer.msg("保存成功!");
            } else {
                layer.msg(data.desc);
                $('.save').prev().css('display', 'none');
            }
        }
    });

    var i=0;
    //图片上传
    var imageViewShow = '$!imgViewAddress';
    var businessPic= '$!baseInfoParam.businessPic';
    var headIdcardPic= '$!baseInfoParam.headIdcardPic';
    var logo= '$!baseInfoParam.logo';
    //单文件上传
    function FileUpload() {
        this.portrait = function (target, uploadUrl, data) {
            target.fileinput({
                language: 'zh', //设置语言
                uploadUrl: '/file/upload_Resize_file', //上传的地址
                dropZoneEnabled: false,//是否显示拖拽区域
                uploadExtraData: data,//上传时除了文件以外的其他额外数据
                allowedPreviewTypes: ['image'],
                allowedFileTypes: ['image'],
                allowedFileExtensions:  ['gif', 'jpg' ,'png'],
                showRemove: false,
                showCancel: false,
                showUpload: true, //是否显示上传按钮
                showCaption: false,//是否显示标题
                maxFileSize : 8192,
                maxFileCount: 1,
                browseClass: "btn btn-primary"
            }).on("fileuploaded", function(event, data) {
                if(data && data.response && data.response.code == 0){
                    //添加图片
                    var val = data.response.rows  ;
                    var _html='<img class="delimg" src="../static/images/delimg.png"><img class="upimg" src="'+imageViewShow+data.response.rows+'">';
                    var $imgdiv=$btn.parents(".form-group").next().find(".img-box1");
                    $imgdiv.append(_html);
                    if($imgdiv.html()==null || $imgdiv.html().length == 0){
                        $imgdiv.append(_html);
                    }else{
                        $imgdiv.find("img").remove();
                        $imgdiv.append(_html);
                    }

                    $btn.parents(".form-group").find(".img").val(val);

                }else{
                    alert(data.response.desc);
                }
                var modal = $.scojs_modal({
                    keyboard: true
                });
                modal.close();

            });
        }
    }

    //身份证，营业执照上传
    function Filerectangle() {
        this.portrait = function (target, uploadUrl, data) {
            target.fileinput({
                language: 'zh', //设置语言
                uploadUrl: '/file/upload_Resize_file', //上传的地址
                dropZoneEnabled: false,//是否显示拖拽区域
                uploadExtraData: data,//上传时除了文件以外的其他额外数据
                allowedPreviewTypes: ['image'],
                allowedFileTypes: ['image'],
                allowedFileExtensions:  ['gif', 'jpg','png'],
                showRemove: false,
                showCancel: false,
                showUpload: true, //是否显示上传按钮
                showCaption: false,//是否显示标题
                maxFileSize : 8192,
                maxFileCount: 1,
                browseClass: "btn btn-primary"
            }).on("fileuploaded", function(event, data) {
                if(data && data.response && data.response.code == 0){
                    //添加图片
                    var val = data.response.rows  ;
                    var _html='<img class="delimg" src="../static/images/delimg.png"><img class="upimg" src="'+imageViewShow+data.response.rows+'">';
                    var $imgdiv=$btn.parents(".form-group").next().find(".img-box1");
                    $imgdiv.append(_html);
                    if($imgdiv.html()==null || $imgdiv.html().length == 0){
                        $imgdiv.append(_html);
                    }else{
                        $imgdiv.find("img").remove();
                        $imgdiv.append(_html);
                    }

                    $btn.parents(".form-group").find(".img").val(val);

                }else{
                    alert(data.response.desc);
                }
                var modal = $.scojs_modal({
                    keyboard: true
                });
                modal.close();

            });
        }
    }


    //展示
    var logo = "$!baseInfoParam.logo";
    if(logo!=null && logo!=''){
        var _html='<div class="item foodimg"><img src="'+imageViewShow+logo+'" class="wh200"></div>';
        var _img = $("[name=logo]").parents(".form-group").next().find(".img-box1");
        if(_img.html()==null || _img.html().length == 0){
            _img.append(_html);
        }
        $("[name=logo]").val(logo);
    }

    var businessPic="$!baseInfoParam.businessPic";
    if(businessPic!=null && businessPic!=''){
        var _html='<div class="tiem foodimg"><img src="'+imageViewShow+businessPic+'" class="upimg"></div>';
        var _img = $("[name=businessPic]").parents(".form-group").next().find(".img-box1");
        if(_img.html()==null || _img.html().length == 0){
            _img.append(_html);
        }
        $("[name=businessPic]").val(businessPic);
    }

    var headIdcardPic="$!baseInfoParam.headIdcardPic";
    if(headIdcardPic!=null && headIdcardPic!=''){
        var _html='<div class="tiem foodimg"><img src="'+imageViewShow+headIdcardPic+'" class="upimg"></div>';
        var _img = $("[name=headIdcardPic]").parents(".form-group").next().find(".img-box1");
        if(_img.html()==null || _img.html().length == 0){
            _img.append(_html);
        }
        $("[name=headIdcardPic]").val(headIdcardPic);
    }

    if('$!canteenHealthPicList'){
        var businessHealthPics=$.parseJSON('$!canteenHealthPicList');
        if(businessHealthPics && businessHealthPics.length>0){
            for(var n=0;n<businessHealthPics.length;n++){
                if(businessHealthPics[n].businessHealthPic !=null && businessHealthPics[n].businessHealthPic!=''){
                    //添加图片
                    var val = businessHealthPics[n].businessHealthPic  ;
                    var _html='<img class="delimg" src="../static/images/delimg.png"><img class="upimg" src="'+imageViewShow+val+'">';
                    var $imgdiv=$("#businessBtn").parents(".form-group").next().find(".img-box1");
                    $imgdiv.append(_html);
                    if($imgdiv.html()==null || $imgdiv.html().length == 0){
                        $imgdiv.append(_html);
                    }else{
                        $imgdiv.find("img").remove();
                        $imgdiv.append(_html);
                    }

                    $("#businessBtn").parents(".form-group").find(".img").val(val);

                }
            }
        }
    }


    function isNotNull(str){
        if(str && str != undefined && str != null && str != ''){
            return true;
        }
    }

    if(isNotNull(logo) || isNotNull(businessPic)  || isNotNull(headIdcardPic)){
        //添加图片
        //赋值
        var _html='<div class="item foodimg"><img src="'+imageViewShow+logo+'" class="upimg" id="logo1"></div>';
        if($(".imgsbox1").html()==null || $(".imgsbox1").html().length == 0){
            $(".imgsbox1").append(_html);
        }else{
            $(".imgsbox1").find(".foodimg").remove();
            $(".imgsbox1").append(_html);
        }

        var _html1 = '<div class="item foodimg"><img src="'+imageViewShow+headIdcardPic+'" class="upimg" id="headIdcardPic1"></div>';
        if ($(".imgsbox2").html() == null
            || $(".imgsbox2").html().length == 0) {
            $(".imgsbox2").append(_html1);
        } else {
            $(".imgsbox2").find(".foodimg").remove();
            $(".imgsbox2").append(_html1);
        }

        var _html2 = '<div class="item foodimg"><img src="'+imageViewShow+businessPic+'" class="upimg" id="businessPic1"></div>';
        if ($(".imgsbox3").html() == null
            || $(".imgsbox3").html().length == 0) {
            $(".imgsbox3").append(_html2);
        } else {
            $(".imgsbox3").find(".foodimg").remove();
            $(".imgsbox3").append(_html2);
        }

    }


    //删除图片
    $("body").on("click",".delimg",function() {
        var _html = "<p>确认删除该图片？</p>";
        var _this = this;
        layer.open({
            title : "删除图片",
            content : _html,
            icon: 3,
            btn : [ '确定', '取消' ],
            yes : function(index, layero) {
                //按钮【按钮一】的回调
                layer.close(index);
                //删除图片
                $(_this).parents(".form-group").prev().find(".img").val('');
                $(_this).parent().find("img").remove();
            },
            btn2 : function(index, layero) {
                //按钮【按钮二】的回调
            },
            cancel : function() {
                //右上角关闭回调
            }
        })
    });
    //地图初始化ip定位城市
    var map = new BMap.Map("allmap");
    var position = "$!baseInfoParam.position";
    if (position != null && position != undefined && position != '') {
        myFun2(position);
    } else {
        var myCity = new BMap.LocalCity();
        myCity.get(myFun);
    }
    //地址改变清空地址输入框
    $(".prov").change(function(){
        $(".address").val("");
        $(".position").val("");
    });
    $(".city").change(function(){
        $(".address").val("");
        $(".position").val("");
    });
    $(".dist").change(function(){
        $(".address").val("");
        $(".position").val("");
    });
    //录入使用
    function myFun(result) {
        var cityName = result.name;
        var new_point = new BMap.Point(cityName.lng, cityName.lat);//读入的经纬度
        map.centerAndZoom(new_point, 13);
        map.enableScrollWheelZoom(true);
        map.setCenter(cityName);
        //地图空间
        var top_left_control = new BMap.ScaleControl({
            anchor : BMAP_ANCHOR_TOP_LEFT
        });// 左上角，添加比例尺
        var top_left_navigation = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件

        map.addControl(top_left_control);
        map.addControl(top_left_navigation);
    }

    //编辑使用
    function myFun2(result) {
        var posiArry = result.split(",");
        var new_point = new BMap.Point(posiArry[0], posiArry[1]);//读入的经纬度
        var marker = new BMap.Marker(new_point); // 创建标注
        var top_left_control = new BMap.ScaleControl({
            anchor : BMAP_ANCHOR_TOP_LEFT
        });// 左上角，添加比例尺
        var top_left_navigation = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件
        map.centerAndZoom(new_point, 14);
        map.enableScrollWheelZoom(true);
        map.addOverlay(marker);
        map.panTo(new_point);
        map.addControl(top_left_control);
        map.addControl(top_left_navigation);

        marker.enableDragging();
        marker.addEventListener("dragend", function(e){
            /* //移动标注显示地址
             myGeo.getLocation(e.point, function(rs){
             var addComp = rs.addressComponents;
             document.getElementById("sult").innerHTML =addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber;
             }); */
            longitude = e.point.lng;
            latitude = e.point.lat;
            $(".position").val(longitude + "," + latitude);
        });
    }

    function myFunction() {
        var abc = $(".prov option:selected").text();
        abc += $(".city option:selected").text();
        abc += $(".dist option:selected").text();
        abc += $(".address").val();
        // 创建地址解析器实例
        var myGeo = new BMap.Geocoder();
        // 将地址解析结果显示在地图上,并调整地图视野
        map.clearOverlays();
        myGeo.getPoint(abc, function(point) {
            if (point) {
                var marker = new BMap.Marker(point);
                map.centerAndZoom(point, 14);
                map.enableScrollWheelZoom(true);
                map.addOverlay(marker);
                marker.enableDragging();
                /* document.getElementById("result").innerHTML = point.lng + ", " + point.lat;//打印原坐标 */
                //经纬度
                longitude = point.lng;
                latitude = point.lat;
                $(".position").val(longitude + "," + latitude);
                //移动标注后重新取经纬度
                marker.addEventListener("dragend", function(e){
                    /* //移动标注显示地址
                     myGeo.getLocation(e.point, function(rs){
                     var addComp = rs.addressComponents;
                     document.getElementById("sult").innerHTML =addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber;
                     }); */
                    longitude = e.point.lng;
                    latitude = e.point.lat;
                    $(".position").val(longitude + "," + latitude);

                });
            } else {
                alert("您选择地址没有解析到结果!");
            }
        });
    };

    /* 地理联动 */
    $(function(){
        if('$!canteenId'==""){
            $('#city').citySelect({
                url:"../../js/cityselect/city.min.js",
                prov:"", //省
                city:"", //市
                dist:"", //区
                nodata:"none", //当子集无数据时，隐藏select
                required:false
            });
        }else{
            $('#city').citySelect({
                url : "../../js/cityselect/city.min.js",
                prov : "$!prov", //省份
                city : "$!city", //城市
                dist : "$!dist", //区县
                nodata : "none" //当子集无数据时，隐藏select
            });
        }
    });


    /*单位信息*/
    /* 表单验证 */
    $('.save').click(function(){
        if($('.Validform_checktip').hasClass('.Validform_wrong')){
            $(this).prev().css('display','block');
        }
    });
    var validForm=$('.form-horizontal').Validform({
        btnSubmit:".save",
        tiptype:2,
        datatype:{
            "zh2-10":/^[\u4E00-\u9FA5\uf900-\ufa2d]{2,10}$/,
            "zn":/^[\u4E00-\u9FA50-9]+$/,
            "n11":/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|17[0|1|3|5|6|7|8]|18[0|1|2|3|5|6|7|8|9])\d{8}$/
        },
        postonce:true,
        ajaxPost:true,
        callback:function(data){
            if(data && data.code==0){
                $('.save').prev().css('display','none');
                parent.$("table").bootstrapTable('refresh');
                parent.layer.closeAll();
                parent.layer.msg("保存成功!");
            }else{
                layer.msg(data.desc);
                $('.save').prev().css('display','none');
            }
        }
    });
    var postData=$("#from").serialize();
    validForm.config({
        showAllError:true,
        url:"$!rc.contextPath/enterpriseUser/addUserAndEnterprise",
        ajaxPost:{
            data:postData
        }
    });

    /* 地理联动 */
    $('#city').citySelect({
        url:"$!rc.contextPath/static/js/cityselect/city.min.js",
        prov:"", //省
        city:"", //市
        dist:"", //区
        nodata:"none", //当子集无数据时，隐藏select
        required:false
    });

    //地图初始化ip定位城市
    var map = new BMap.Map("allmap");
    var position="";
    position="$!epo.position";

    if (position != null && position != undefined && position != '') {
        myFun2(position);
    }else{
        var myCity = new BMap.LocalCity();
        myCity.get(myFun);
    }
    //地址改变清空地址输入框
    $(".prov").change(function(){
        $(".address").val("");
        $(".position").val("");
    });
    $(".city").change(function(){
        $(".address").val("");
        $(".position").val("");
    });
    $(".dist").change(function(){
        $(".address").val("");
        $(".position").val("");
    });
    //录入使用
    function myFun(result){
        var cityName = result.name;
        var new_point = new BMap.Point(cityName.lng,cityName.lat);//读入的经纬度
        map.centerAndZoom(new_point, 13);
        map.enableScrollWheelZoom(true);
        map.setCenter(cityName);
        //地图空间
        var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
        var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件

        map.addControl(top_left_control);
        map.addControl(top_left_navigation);
    }

    //编辑使用
    function myFun2(result){
        var posiArry=result.split(",");
        var new_point = new BMap.Point(posiArry[0],posiArry[1]);//读入的经纬度
        var marker = new BMap.Marker(new_point);  // 创建标注
        var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
        var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
        map.centerAndZoom(new_point,14);
        map.enableScrollWheelZoom(true);
        map.addOverlay(marker);
        map.panTo(new_point);
        map.addControl(top_left_control);
        map.addControl(top_left_navigation);

        marker.enableDragging();
        marker.addEventListener("dragend", function(e){
            /* //移动标注显示地址
             myGeo.getLocation(e.point, function(rs){
             var addComp = rs.addressComponents;
             document.getElementById("sult").innerHTML =addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber;
             }); */
            longitude = e.point.lng;
            latitude = e.point.lat;
            $(".position").val(longitude + "," + latitude);
        });
    }

    function myFunction(){
        var abc=$(".prov option:selected").text();
        abc+=$(".city option:selected").text();
        abc+=$(".dist option:selected").text();
        abc+=$(".address").val();

        // 创建地址解析器实例
        var myGeo = new BMap.Geocoder();

        // 将地址解析结果显示在地图上,并调整地图视野
        map.clearOverlays();
        myGeo.getPoint(abc, function(point){
            if (point) {
                var marker = new BMap.Marker(point);
                map.centerAndZoom(point, 14);
                map.enableScrollWheelZoom(true);
                map.addOverlay(marker);
                marker.enableDragging();
                /* document.getElementById("result").innerHTML = point.lng + ", " + point.lat;//打印原坐标 */
                //经纬度
                longitude = point.lng;
                latitude = point.lat;
                $(".position").val(longitude + "," + latitude);
                //移动标注后重新取经纬度
                marker.addEventListener("dragend", function(e){
                    longitude = e.point.lng;
                    latitude = e.point.lat;
                    $(".position").val(longitude + "," + latitude);

                });
            }else{
                alert("您选择地址没有解析到结果!");
            }
        });
    }


</script>
</body>
</html>





